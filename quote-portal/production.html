<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ãœretim Paneli - Burkol MES</title>
  <script type="module" src="./components/BurkolNavigation.js"></script>
  <script type="module" src="./components/AuthGuard.js"></script>
  
  <!-- Tailwind CSS CDN for modern styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide React Icons CDN -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  
  <style>
    /* Custom CSS variables for design system */
    :root {
      --background: #ffffff;
      --foreground: #0c0a09;
      --muted: #f5f5f4;
      --muted-foreground: #78716c;
      --popover: #ffffff;
      --popover-foreground: #0c0a09;
      --border: #e7e5e4;
      --input: #e7e5e4;
      --card: #ffffff;
      --card-foreground: #0c0a09;
      --primary: #0c0a09;
      --primary-foreground: #fafaf9;
      --secondary: #f5f5f4;
      --secondary-foreground: #0c0a09;
      --accent: #f5f5f4;
      --accent-foreground: #0c0a09;
      --destructive: #ef4444;
      --destructive-foreground: #fef2f2;
      --ring: #d6d3d1;
      --radius: 0.5rem;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f8fafc;
      color: var(--foreground);
      line-height: 1.5;
    }

    /* Modern Card Component */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      overflow: hidden;
    }

    .card-header {
      padding: 24px 24px 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--card-foreground);
      line-height: 1.2;
    }

    .card-description {
      font-size: 14px;
      color: var(--muted-foreground);
    }

    .card-content {
      padding: 24px;
    }

    /* Badge Component */
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      border: 1px solid transparent;
      padding: 4px 8px;
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
      transition: all 0.2s;
    }

    .badge-default {
      background: var(--primary);
      color: var(--primary-foreground);
    }

    .badge-secondary {
      background: var(--secondary);
      color: var(--secondary-foreground);
    }

    .badge-outline {
      border: 1px solid var(--border);
      color: var(--foreground);
    }

    .badge-success {
      background: #10b981;
      color: white;
    }

    .badge-warning {
      background: #f59e0b;
      color: white;
    }

    .badge-destructive {
      background: var(--destructive);
      color: var(--destructive-foreground);
    }

    /* Progress Bar Component */
    .progress {
      position: relative;
      width: 100%;
      height: 8px;
      background: var(--secondary);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-indicator {
      height: 100%;
      background: var(--primary);
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    /* Modern Table */
    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table th,
    .table td {
      text-align: left;
      padding: 12px;
      border-bottom: 1px solid var(--border);
    }

    .table th {
      font-weight: 600;
      background: var(--muted);
    }

    .table tr:hover {
      background: var(--muted);
    }

    /* Plan Designer specific styles */
    .canvas-node {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .canvas-node:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
    }

    .canvas-node.dragging {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(0,0,0,0.25) !important;
      z-index: 20;
    }

    .connection-line {
      transition: background-color 0.2s ease;
    }

    .connection-line:hover {
      background-color: #ef4444 !important;
    }

    .arrow-head {
      transition: border-left-color 0.2s ease;
    }

    .middle-arrow {
      transition: border-left-color 0.2s ease;
    }

    .connection-delete-btn {
      transition: all 0.2s ease;
    }

    .connection-delete-btn:hover {
      background: #dc2626 !important;
      transform: scale(1.1);
    }

    .drag-handle {
      user-select: none;
    }

    /* Toast animations */
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    /* Modal styles */
    #node-edit-modal {
      backdrop-filter: blur(4px);
    }

    #node-edit-modal > div {
      animation: modalSlideIn 0.3s ease;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translate(-50%, -60%) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .table thead {
      background: var(--muted);
    }

    .table th {
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      color: var(--muted-foreground);
      border-bottom: 1px solid var(--border);
    }

    .table td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
    }

    .table tr:hover {
      background: var(--muted);
    }

    /* Layout */
    .app-layout {
      display: flex;
      height: 100vh;
      margin-top: 70px; /* Account for Burkol navbar */
    }

    .sidebar {
      width: 280px;
      background: var(--card);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .main-content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    /* Sidebar Navigation */
    .nav-group {
      padding: 8px 0;
    }

    .nav-group-header {
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted-foreground);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      padding: 12px 16px;
      background: none;
      border: none;
      text-align: left;
      font-size: 14px;
      color: var(--foreground);
      border-radius: 0;
      transition: all 0.2s;
      cursor: pointer;
    }

    .nav-item:hover {
      background: var(--accent);
    }

    .nav-item.active {
      background: var(--primary);
      color: var(--primary-foreground);
    }

    .nav-item-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-item-badge {
      margin-left: auto;
      padding: 2px 6px;
      background: #ef4444;
      color: white;
      font-size: 10px;
      border-radius: 10px;
    }

    /* Grid System */
    .grid {
      display: grid;
      gap: 24px;
    }

    .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
    .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
    .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }

    /* Responsive */
    @media (max-width: 1024px) {
      .grid-cols-4 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .sidebar {
        width: 240px;
      }
    }

    @media (max-width: 768px) {
      .app-layout {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        height: auto;
        max-height: 200px;
        border-right: none;
        border-bottom: 1px solid var(--border);
        order: 2;
      }
      
      .sidebar .nav-group {
        display: none; /* Hide nav groups on mobile, show only active */
      }
      
      .sidebar .nav-group:first-child {
        display: block; /* Show only first group on mobile */
      }
      
      .main-content {
        padding: 16px;
        order: 1;
      }
      
      .grid-cols-2,
      .grid-cols-3,
      .grid-cols-4 {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .card-content {
        padding: 16px;
      }
      
      .card-header {
        padding: 16px 16px 0;
      }
      
      .kpi-value {
        font-size: 28px;
      }
      
      /* Mobile optimized table */
      .table {
        font-size: 12px;
      }
      
      .table th,
      .table td {
        padding: 8px 12px;
      }
      
      /* Hide some columns on mobile */
      .table th:nth-child(3),
      .table td:nth-child(3),
      .table th:nth-child(6),
      .table td:nth-child(6) {
        display: none;
      }
      
      /* Mobile navigation */
      .mobile-nav-toggle {
        display: block;
        position: fixed;
        top: 80px;
        left: 16px;
        z-index: 1001;
        background: var(--primary);
        color: var(--primary-foreground);
        border: none;
        border-radius: 6px;
        padding: 8px;
        cursor: pointer;
      }
    }

    @media (min-width: 769px) {
      .mobile-nav-toggle {
        display: none;
      }
    }

    /* Enhanced mobile sidebar */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        top: 70px;
        left: 0;
        bottom: 0;
        width: 280px;
        height: calc(100vh - 70px);
        max-height: none;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 1000;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      }
      
      .sidebar.mobile-open {
        transform: translateX(0);
      }
      
      .sidebar .nav-group {
        display: block; /* Show all nav groups when sidebar is open */
      }
      
      .mobile-overlay {
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .mobile-overlay.active {
        opacity: 1;
        visibility: visible;
      }
    }

    /* Improved touch targets for mobile */
    @media (max-width: 768px) {
      .nav-item {
        padding: 16px;
        font-size: 16px;
      }
      
      button {
        min-height: 44px;
        min-width: 44px;
      }
      
      .badge {
        font-size: 14px;
        padding: 6px 12px;
      }
    }

    /* Status Colors */
    .status-planned { color: #6b7280; }
    .status-in-progress { color: #3b82f6; }
    .status-on-hold { color: #f59e0b; }
    .status-completed { color: #10b981; }

    /* KPI Cards */
    .kpi-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      position: relative;
      overflow: hidden;
    }

    .kpi-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      pointer-events: none;
    }

    .kpi-card-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .kpi-card-warning {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .kpi-card-info {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    }

    .kpi-card-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }

    .kpi-card .card-title {
      color: white;
      font-size: 14px;
      font-weight: 500;
      opacity: 0.9;
    }

    .kpi-card .card-description {
      color: rgba(255, 255, 255, 0.8);
    }

    .kpi-value {
      font-size: 36px;
      font-weight: 700;
      margin: 12px 0 8px 0;
      line-height: 1;
    }

    .kpi-change {
      font-size: 12px;
      opacity: 0.9;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .kpi-icon {
      position: absolute;
      top: 16px;
      right: 16px;
      font-size: 24px;
      opacity: 0.3;
    }

    /* Real-time indicators */
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .status-online { background: #10b981; }
    .status-busy { background: #f59e0b; }
    .status-offline { background: #ef4444; }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    /* Enhanced Progress bars */
    .progress-enhanced {
      position: relative;
      width: 100%;
      height: 12px;
      background: rgba(0,0,0,0.1);
      border-radius: 6px;
      overflow: hidden;
    }

    .progress-enhanced .progress-indicator {
      height: 100%;
      border-radius: 6px;
      transition: width 0.3s ease;
      position: relative;
    }

    .progress-enhanced .progress-indicator::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Help System Styles */
    .help-button {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
      z-index: 1001;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .help-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(59, 130, 246, 0.6);
    }

    .help-button:active {
      transform: scale(0.95);
    }

    .help-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1002;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .help-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .help-panel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      z-index: 1003;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .help-panel.active {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }

    .help-header {
      padding: 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    }

    .help-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--foreground);
      margin: 0;
    }

    .help-subtitle {
      font-size: 14px;
      color: var(--muted-foreground);
      margin: 4px 0 0 0;
    }

    .help-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted-foreground);
      padding: 8px;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .help-close:hover {
      background: var(--muted);
      color: var(--foreground);
    }

    .help-content {
      padding: 24px;
      overflow-y: auto;
      max-height: calc(80vh - 120px);
    }

    .help-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 24px;
      border-bottom: 1px solid var(--border);
    }

    .help-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: var(--muted-foreground);
      transition: all 0.2s;
      position: relative;
    }

    .help-tab.active {
      color: var(--primary);
      background: var(--accent);
    }

    .help-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary);
    }

    .help-tab:hover:not(.active) {
      background: var(--muted);
    }

    .help-section {
      display: none;
    }

    .help-section.active {
      display: block;
    }

    .help-step {
      margin-bottom: 24px;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--card);
    }

    .help-step-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .help-step-number {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }

    .help-step-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--foreground);
      margin: 0;
    }

    .help-step-description {
      color: var(--muted-foreground);
      margin-bottom: 16px;
      line-height: 1.6;
    }

    .help-step-details {
      background: var(--muted);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .help-step-details ul {
      margin: 0;
      padding-left: 20px;
    }

    .help-step-details li {
      margin-bottom: 8px;
      color: var(--foreground);
      line-height: 1.5;
    }

    .help-action-button {
      background: var(--primary);
      color: var(--primary-foreground);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .help-action-button:hover {
      background: var(--accent);
      color: var(--accent-foreground);
    }

    .help-faq-item {
      margin-bottom: 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    .help-faq-question {
      width: 100%;
      background: none;
      border: none;
      padding: 16px;
      text-align: left;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }

    .help-faq-question:hover {
      background: var(--muted);
    }

    .help-faq-answer {
      padding: 0 16px;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .help-faq-answer.open {
      padding: 16px;
      max-height: 200px;
    }

    @media (max-width: 768px) {
      .help-button {
        bottom: 16px;
        right: 16px;
        width: 48px;
        height: 48px;
        font-size: 18px;
      }

      .help-panel {
        width: 95%;
        max-height: 90vh;
      }

      .help-header {
        padding: 16px;
      }

      .help-content {
        padding: 16px;
        max-height: calc(90vh - 100px);
      }

      .help-tabs {
        flex-wrap: wrap;
      }

      .help-tab {
        padding: 8px 16px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="app-layout">
    <!-- Mobile Navigation Toggle -->
    <button class="mobile-nav-toggle" onclick="toggleMobileNav()">
      â˜°
    </button>
    
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" onclick="closeMobileNav()"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div style="padding: 24px 0;">
        <!-- Logo Area -->
        <div style="padding: 0 16px 16px; border-bottom: 1px solid var(--border);">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #2563eb, #1d4ed8); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px;">
              ğŸ­
            </div>
            <div>
              <h2 style="font-size: 16px; font-weight: 600; color: var(--foreground); margin-bottom: 2px;">MES System</h2>
              <p style="font-size: 12px; color: var(--muted-foreground);">Manufacturing Execution</p>
            </div>
          </div>
        </div>
        
        <!-- Navigation Groups -->
        <div class="nav-group">
          <div class="nav-group-header">Monitoring & Tracking</div>
          <div class="nav-group-content">
            <button class="nav-item active" onclick="navigateToView('dashboard')">
              <div class="nav-item-icon">ğŸ“Š</div>
              <span>Dashboard</span>
            </button>
            <button class="nav-item" onclick="navigateToView('worker-panel')">
              <div class="nav-item-icon">ğŸ‘·</div>
              <span>Worker Panel</span>
            </button>
          </div>
        </div>
        
        <div class="nav-group">
          <div class="nav-group-header">Production Planning</div>
          <div class="nav-group-content">
            <button class="nav-item" onclick="navigateToView('plan-designer')">
              <div class="nav-item-icon">ğŸ¨</div>
              <span>Plan Designer</span>
            </button>
            <button class="nav-item" onclick="navigateToView('templates')">
              <div class="nav-item-icon">ğŸ“„</div>
              <span>Templates</span>
            </button>
          </div>
        </div>
        
        <div class="nav-group">
          <div class="nav-group-header">Setup & Configuration</div>
          <div class="nav-group-content">
            <button class="nav-item" onclick="navigateToView('settings')">
              <div class="nav-item-icon">âš¡</div>
              <span>Master Data</span>
              <span class="nav-item-badge">Start here</span>
            </button>
            <button class="nav-item" onclick="navigateToView('stations')">
              <div class="nav-item-icon">ğŸ­</div>
              <span>Stations</span>
            </button>
            <button class="nav-item" onclick="navigateToView('operations')">
              <div class="nav-item-icon">âš™ï¸</div>
              <span>Operations</span>
            </button>
            <button class="nav-item" onclick="navigateToView('workers')">
              <div class="nav-item-icon">ğŸ‘¥</div>
              <span>Workers</span>
            </button>
          </div>
        </div>
        
        <!-- Footer -->
        <div style="padding: 16px; border-top: 1px solid var(--border); margin-top: auto;">
          <div style="font-size: 11px; color: var(--muted-foreground);">
            <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px;">
              <div style="width: 6px; height: 6px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite;"></div>
              <span>System Online</span>
            </div>
            <p>Version 1.0.0</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div id="content-area">
        <!-- Dashboard Content will be injected here -->
      </div>
    </div>
  </div>

  <!-- Help System -->
  <button class="help-button" onclick="openHelp()" title="Help & Guide">
    ?
  </button>

  <!-- Help Overlay -->
  <div class="help-overlay" id="help-overlay" onclick="closeHelp()"></div>

  <!-- Help Panel -->
  <div class="help-panel" id="help-panel">
    <div class="help-header">
      <div>
        <h2 class="help-title">ğŸ­ MES Sistemi KullanÄ±m Rehberi</h2>
        <p class="help-subtitle">Ãœretim YÃ¶netim Sistemi tam kullanÄ±m kÄ±lavuzu</p>
      </div>
      <button class="help-close" onclick="closeHelp()">Ã—</button>
    </div>
    
    <div class="help-content">
      <!-- Help Tabs -->
      <div class="help-tabs">
        <button class="help-tab active" onclick="switchHelpTab('setup')">ğŸš€ Kurulum</button>
        <button class="help-tab" onclick="switchHelpTab('usage')">ğŸ“Š KullanÄ±m</button>
        <button class="help-tab" onclick="switchHelpTab('features')">âš¡ Ã–zellikler</button>
        <button class="help-tab" onclick="switchHelpTab('faq')">â“ S.S.S</button>
      </div>

      <!-- Setup Guide Section -->
      <div class="help-section active" id="help-setup">
        <div class="help-step">
          <div class="help-step-header">
            <div class="help-step-number">1</div>
            <h3 class="help-step-title">Master Data TanÄ±mlama</h3>
          </div>
          <p class="help-step-description">Sistemdeki temel veri yapÄ±larÄ±nÄ± oluÅŸturun. Bu adÄ±m tÃ¼m sistem iÃ§in kritiktir.</p>
          <div class="help-step-details">
            <ul>
              <li><strong>Skills (Yetenekler):</strong> CNC Programming, Welding, Assembly, Quality Control</li>
              <li><strong>Operation Types:</strong> Machining, Welding, Painting, Assembly, Quality</li>
              <li><strong>Material Types:</strong> Steel, Aluminum, Plastic vb.</li>
              <li>Bu veriler tÃ¼m sistemde kullanÄ±lacak - Ã¶nce bunlarÄ± tanÄ±mlayÄ±n!</li>
            </ul>
          </div>
          <button class="help-action-button" onclick="navigateToView('settings'); closeHelp();">Master Data'ya Git</button>
        </div>

        <div class="help-step">
          <div class="help-step-header">
            <div class="help-step-number">2</div>
            <h3 class="help-step-title">Ä°stasyonlarÄ± OluÅŸturun</h3>
          </div>
          <p class="help-step-description">Ãœretim istasyonlarÄ±nÄ± ve iÅŸ merkezlerini tanÄ±mlayÄ±n.</p>
          <div class="help-step-details">
            <ul>
              <li>Fabrikadaki her istasyonu ekleyin (CNC Mill 01, Welding Station A, vb.)</li>
              <li>Her istasyon iÃ§in: Ä°sim, Tip, Kapasite, Durum belirleyin</li>
              <li>Ã–rnek: 'CNC Mill 01' - Tip: 'CNC Milling Machine' - Kapasite: 1 worker</li>
              <li>Station status: Active, Maintenance, Offline</li>
            </ul>
          </div>
          <button class="help-action-button" onclick="navigateToView('stations'); closeHelp();">Ä°stasyonlara Git</button>
        </div>

        <div class="help-step">
          <div class="help-step-header">
            <div class="help-step-number">3</div>
            <h3 class="help-step-title">OperasyonlarÄ± TanÄ±mlayÄ±n</h3>
          </div>
          <p class="help-step-description">Ãœretim operasyonlarÄ±nÄ± yapÄ±landÄ±rÄ±n.</p>
          <div class="help-step-details">
            <ul>
              <li>Her Ã¼retim operasyonunu ekleyin (CNC Milling, Welding, Quality Control, vb.)</li>
              <li><strong>Operation Type:</strong> Ã–nceki adÄ±mda tanÄ±mladÄ±ÄŸÄ±nÄ±z tiplerden seÃ§in</li>
              <li><strong>Required Skills:</strong> Hangi yetenekler gerekli</li>
              <li><strong>Required Station:</strong> Hangi istasyonda yapÄ±lacak</li>
              <li><strong>Estimated Time:</strong> Tahmini sÃ¼re (dakika)</li>
            </ul>
          </div>
          <button class="help-action-button" onclick="navigateToView('operations'); closeHelp();">Operasyonlara Git</button>
        </div>

        <div class="help-step">
          <div class="help-step-header">
            <div class="help-step-number">4</div>
            <h3 class="help-step-title">Ä°ÅŸÃ§ileri Sisteme Ekleyin</h3>
          </div>
          <p class="help-step-description">Ä°ÅŸÃ§ileri ve yeteneklerini tanÄ±mlayÄ±n.</p>
          <div class="help-step-details">
            <ul>
              <li><strong>Name & Email:</strong> Temel bilgiler</li>
              <li><strong>Skills:</strong> Hangi yeteneklere sahip (master data'dan seÃ§in)</li>
              <li><strong>Assigned Operations:</strong> Hangi operasyonlarÄ± yapabilir</li>
              <li><strong>Assigned Stations:</strong> Hangi istasyonlarda Ã§alÄ±ÅŸabilir</li>
              <li><strong>Shift:</strong> Day/Night vardiya</li>
              <li><strong>Status:</strong> Available/Busy/On Leave</li>
            </ul>
          </div>
          <button class="help-action-button" onclick="navigateToView('workers'); closeHelp();">Ä°ÅŸÃ§ilere Git</button>
        </div>
      </div>

      <!-- Usage Guide Section -->
      <div class="help-section" id="help-usage">
        <div class="help-step">
          <div class="help-step-header">
            <div class="help-step-number">ğŸ“Š</div>
            <h3 class="help-step-title">Dashboard KullanÄ±mÄ±</h3>
          </div>
          <p class="help-step-description">Ana dashboard'da Ã¼retim durumunuzu takip edin.</p>
          <div class="help-step-details">
            <ul>
              <li><strong>KPI KartlarÄ±:</strong> Aktif sipariÅŸler, tamamlanan iÅŸler, verimlilik</li>
              <li><strong>Work Orders Tablosu:</strong> TÃ¼m iÅŸ emirlerinin durumu</li>
              <li><strong>Progress Bar'lar:</strong> Her iÅŸ emrinin tamamlanma oranÄ±</li>
              <li><strong>Status Badge'larÄ±:</strong> Planlanan, Devam Eden, Bekleyen, Tamamlanan</li>
              <li><strong>Real-time Updates:</strong> Veriler otomatik gÃ¼ncellenir</li>
            </ul>
          </div>
          <button class="help-action-button" onclick="navigateToView('dashboard'); closeHelp();">Dashboard'a Git</button>
        </div>

        <div class="help-step">
          <div class="help-step-header">
            <div class="help-step-number">ğŸ‘·</div>
            <h3 class="help-step-title">Worker Panel</h3>
          </div>
          <p class="help-step-description">Ä°ÅŸÃ§i yÃ¶netimi ve gÃ¶rev takibi.</p>
          <div class="help-step-details">
            <ul>
              <li><strong>Aktif Ä°ÅŸÃ§iler:</strong> Åu anda Ã§alÄ±ÅŸan personel listesi</li>
              <li><strong>GÃ¶rev AtamalarÄ±:</strong> Her iÅŸÃ§inin mevcut gÃ¶revi</li>
              <li><strong>Beceri Matrisi:</strong> Ä°ÅŸÃ§ilerin yetenekleri</li>
              <li><strong>Vardiya YÃ¶netimi:</strong> Day/Night shift planlama</li>
              <li><strong>Performance Tracking:</strong> Ä°ÅŸÃ§i performans takibi</li>
            </ul>
          </div>
          <button class="help-action-button" onclick="navigateToView('worker-panel'); closeHelp();">Worker Panel'e Git</button>
        </div>
      </div>

      <!-- Features Section -->
      <div class="help-section" id="help-features">
        <div class="help-step">
          <div class="help-step-header">
            <div class="help-step-number">âš¡</div>
            <h3 class="help-step-title">Temel Ã–zellikler</h3>
          </div>
          <div class="help-step-details">
            <ul>
              <li><strong>Real-time Dashboard:</strong> AnlÄ±k Ã¼retim takibi</li>
              <li><strong>Work Order Management:</strong> Ä°ÅŸ emri yÃ¶netimi</li>
              <li><strong>Resource Planning:</strong> Kaynak planlama</li>
              <li><strong>Quality Control:</strong> Kalite kontrol entegrasyonu</li>
              <li><strong>Reporting:</strong> DetaylÄ± raporlama sistemi</li>
              <li><strong>Mobile Support:</strong> Mobil cihaz desteÄŸi</li>
            </ul>
          </div>
        </div>

        <div class="help-step">
          <div class="help-step-header">
            <div class="help-step-number">ğŸ¨</div>
            <h3 class="help-step-title">Plan Designer</h3>
          </div>
          <p class="help-step-description">Ãœretim planlarÄ± oluÅŸturun ve optimize edin.</p>
          <div class="help-step-details">
            <ul>
              <li><strong>Drag & Drop:</strong> Kolay planlama arayÃ¼zÃ¼</li>
              <li><strong>Resource Optimization:</strong> Kaynak optimizasyonu</li>
              <li><strong>Timeline View:</strong> Zaman Ã§izelgesi gÃ¶rÃ¼nÃ¼mÃ¼</li>
              <li><strong>Conflict Detection:</strong> Ã‡akÄ±ÅŸma tespiti</li>
              <li><strong>Template Support:</strong> Åablon desteÄŸi</li>
            </ul>
          </div>
          <button class="help-action-button" onclick="navigateToView('plan-designer'); closeHelp();">Plan Designer'a Git</button>
        </div>
      </div>

      <!-- FAQ Section -->
      <div class="help-section" id="help-faq">
        <div class="help-faq-item">
          <button class="help-faq-question" onclick="toggleFAQ(this)">
            <span>Sisteme nasÄ±l baÅŸlarÄ±m?</span>
            <span>â–¼</span>
          </button>
          <div class="help-faq-answer">
            <p>1. Master Data'yÄ± tanÄ±mlayÄ±n (Skills, Operation Types)<br>
            2. Ä°stasyonlarÄ± oluÅŸturun<br>
            3. OperasyonlarÄ± tanÄ±mlayÄ±n<br>
            4. Ä°ÅŸÃ§ileri sisteme ekleyin<br>
            5. Ä°lk Work Order'Ä±nÄ±zÄ± oluÅŸturun</p>
          </div>
        </div>

        <div class="help-faq-item">
          <button class="help-faq-question" onclick="toggleFAQ(this)">
            <span>Veriler nerede saklanÄ±yor?</span>
            <span>â–¼</span>
          </button>
          <div class="help-faq-answer">
            <p>Veriler tarayÄ±cÄ±nÄ±zÄ±n Local Storage'Ä±nda saklanÄ±r. GerÃ§ek ortamda Firebase/Database kullanÄ±lacaktÄ±r.</p>
          </div>
        </div>

        <div class="help-faq-item">
          <button class="help-faq-question" onclick="toggleFAQ(this)">
            <span>Mobile cihazlarda nasÄ±l kullanÄ±rÄ±m?</span>
            <span>â–¼</span>
          </button>
          <div class="help-faq-answer">
            <p>Sistem tamamen responsive tasarlanmÄ±ÅŸtÄ±r. Tablette ve telefonda sidebar menÃ¼ ile tÃ¼m Ã¶zellikler kullanÄ±labilir.</p>
          </div>
        </div>

        <div class="help-faq-item">
          <button class="help-faq-question" onclick="toggleFAQ(this)">
            <span>Sistem nasÄ±l gÃ¼ncellenecek?</span>
            <span>â–¼</span>
          </button>
          <div class="help-faq-answer">
            <p>Sistem real-time gÃ¼ncellemeler alÄ±r. Dashboard verileri otomatik yenilenir. Manuel yenileme iÃ§in sayfayÄ± yenileyin.</p>
          </div>
        </div>

        <div class="help-faq-item">
          <button class="help-faq-question" onclick="toggleFAQ(this)">
            <span>Hangi tarayÄ±cÄ±lar desteklenir?</span>
            <span>â–¼</span>
          </button>
          <div class="help-faq-answer">
            <p>Modern tarayÄ±cÄ±lar: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+. Internet Explorer desteklenmez.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentView = 'dashboard';

    // Simple MES Context - Local Storage Based Data Management
    const MESData = {
      workOrders: [
        {
          id: 'WO-001',
          product: 'Metal Bracket Type A',
          quantity: 100,
          progress: 75,
          status: 'in-progress',
          dueDate: '2025-10-29',
          priority: 'high'
        },
        {
          id: 'WO-002',
          product: 'Steel Frame Assembly',
          quantity: 50,
          progress: 45,
          status: 'on-hold',
          dueDate: '2025-11-02',
          priority: 'normal'
        },
        {
          id: 'WO-003',
          product: 'Custom Welding Job',
          quantity: 25,
          progress: 100,
          status: 'completed',
          dueDate: '2025-10-28',
          priority: 'high'
        },
        {
          id: 'WO-004',
          product: 'Aluminum Sheet Cutting',
          quantity: 200,
          progress: 20,
          status: 'planned',
          dueDate: '2025-11-05',
          priority: 'low'
        }
      ],
      
      workers: [
        {
          id: 'w-001',
          name: 'Ali Kaya',
          email: 'ali@burkol.com',
          skills: ['Welding', 'Cutting'],
          shift: 'Day',
          status: 'active',
          currentTask: 'WO-001',
          station: 'Station A'
        },
        {
          id: 'w-002',
          name: 'Mehmet YÄ±lmaz',
          email: 'mehmet@burkol.com',
          skills: ['Assembly', 'Quality Control'],
          shift: 'Day',
          status: 'active',
          currentTask: 'WO-002',
          station: 'Station B'
        },
        {
          id: 'w-003',
          name: 'Fatma Åahin',
          email: 'fatma@burkol.com',
          skills: ['Assembly', 'Packaging'],
          shift: 'Day',
          status: 'break',
          currentTask: 'WO-003',
          station: 'Station C'
        }
      ],
      
      stations: [
        {
          id: 's-001',
          name: 'Station A - Welding',
          status: 'active',
          worker: 'Ali Kaya',
          capabilities: ['Welding', 'Cutting'],
          currentOperation: 'WO-001 Welding'
        },
        {
          id: 's-002',
          name: 'Station B - Assembly',
          status: 'maintenance',
          worker: null,
          capabilities: ['Assembly', 'Quality Control'],
          currentOperation: null
        }
      ],
      
      operations: [
        {
          id: 'op-001',
          name: 'Welding',
          duration: 30,
          skills: ['Welding'],
          qualityCheck: true
        },
        {
          id: 'op-002',
          name: 'Cutting',
          duration: 15,
          skills: ['Cutting'],
          qualityCheck: false
        },
        {
          id: 'op-003',
          name: 'Assembly',
          duration: 45,
          skills: ['Assembly'],
          qualityCheck: true
        }
      ]
    };

    // Data Management Functions
    function updateKPIs() {
      const activeOrders = MESData.workOrders.filter(wo => wo.status !== 'completed').length;
      const completedToday = MESData.workOrders.filter(wo => wo.status === 'completed').length;
      const activeWorkers = MESData.workers.filter(w => w.status === 'active').length;
      const totalWorkers = MESData.workers.length;
      
      return {
        activeOrders,
        completedToday,
        efficiency: Math.round((completedToday / MESData.workOrders.length) * 100),
        onTimeDelivery: 96,
        activeWorkers,
        totalWorkers
      };
    }

    function updateWorkOrderProgress(orderId, newProgress) {
      const order = MESData.workOrders.find(wo => wo.id === orderId);
      if (order) {
        order.progress = newProgress;
        if (newProgress >= 100) {
          order.status = 'completed';
        }
        // Refresh current view if it's dashboard
        if (currentView === 'dashboard') {
          navigateToView('dashboard');
        }
      }
    }

    function addWorkOrder(orderData) {
      const newOrder = {
        id: 'WO-' + String(Date.now()).slice(-3),
        ...orderData,
        progress: 0,
        status: 'planned'
      };
      MESData.workOrders.push(newOrder);
    }

    function assignWorkerToOrder(workerId, orderId) {
      const worker = MESData.workers.find(w => w.id === workerId);
      const order = MESData.workOrders.find(wo => wo.id === orderId);
      
      if (worker && order) {
        worker.currentTask = orderId;
        worker.status = 'active';
        order.status = 'in-progress';
      }
    }

    // Save data to localStorage
    function saveData() {
      localStorage.setItem('mesData', JSON.stringify(MESData));
    }

    // Load data from localStorage
    function loadData() {
      const saved = localStorage.getItem('mesData');
      if (saved) {
        const parsedData = JSON.parse(saved);
        Object.assign(MESData, parsedData);
      }
    }

    // Initialize data on load
    document.addEventListener('DOMContentLoaded', function() {
      loadData();
      navigateToView('dashboard');
    });

    // Modern Dashboard Generator
    function generateModernDashboard() {
      const kpis = updateKPIs();
      
      return `
        <div style="margin-bottom: 24px;">
          <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">Production Dashboard</h1>
          <p style="color: var(--muted-foreground);">Ãœretim takibi ve KPI izleme - Last updated: ${new Date().toLocaleTimeString()}</p>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-4" style="margin-bottom: 32px;">
          <div class="card kpi-card kpi-card-info">
            <div class="kpi-icon">ğŸ“‹</div>
            <div class="card-content">
              <div class="card-title">Active Orders</div>
              <div class="kpi-value">${kpis.activeOrders}</div>
              <div class="kpi-change">
                <span style="color: #10b981;">â†—</span>
                Real-time data
              </div>
            </div>
          </div>
          
          <div class="card kpi-card kpi-card-success">
            <div class="kpi-icon">âœ…</div>
            <div class="card-content">
              <div class="card-title">Completed Today</div>
              <div class="kpi-value">${kpis.completedToday}</div>
              <div class="kpi-change">
                <span style="color: #34d399;">â†—</span>
                ${kpis.efficiency}% efficiency
              </div>
            </div>
          </div>
          
          <div class="card kpi-card kpi-card-warning">
            <div class="kpi-icon">âš¡</div>
            <div class="card-content">
              <div class="card-title">Active Workers</div>
              <div class="kpi-value">${kpis.activeWorkers}/${kpis.totalWorkers}</div>
              <div class="kpi-change">
                <span style="color: #34d399;">â†—</span>
                ${Math.round((kpis.activeWorkers/kpis.totalWorkers)*100)}% utilization
              </div>
            </div>
          </div>
          
          <div class="card kpi-card kpi-card-success">
            <div class="kpi-icon">ğŸ¯</div>
            <div class="card-content">
              <div class="card-title">On-Time Delivery</div>
              <div class="kpi-value">${kpis.onTimeDelivery}%</div>
              <div class="kpi-change">
                <span style="color: #34d399;">â†’</span>
                Excellent performance
              </div>
            </div>
          </div>
        </div>

        <!-- Real-time Status Bar -->
        <div class="card" style="margin-bottom: 24px;">
          <div class="card-content" style="padding: 16px 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">System Status</h3>
                <p style="font-size: 14px; color: var(--muted-foreground);">Real-time monitoring</p>
              </div>
              <div style="display: flex; gap: 24px;">
                <div class="status-indicator">
                  <div class="status-dot status-online"></div>
                  <span>Production: Online</span>
                </div>
                <div class="status-indicator">
                  <div class="status-dot status-busy"></div>
                  <span>Stations: ${MESData.stations.filter(s => s.status === 'active').length}/${MESData.stations.length} Active</span>
                </div>
                <div class="status-indicator">
                  <div class="status-dot status-online"></div>
                  <span>Workers: ${kpis.activeWorkers}/${kpis.totalWorkers} Available</span>
                </div>
                <div class="status-indicator">
                  <div class="status-dot status-online"></div>
                  <span>Quality: All Systems OK</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Work Orders Table -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">Active Work Orders</div>
            <div class="card-description">Current production orders in the system</div>
          </div>
          <div class="card-content">
            <table class="table">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Product</th>
                  <th>Quantity</th>
                  <th>Progress</th>
                  <th>Status</th>
                  <th>Due Date</th>
                </tr>
              </thead>
              <tbody>
                ${MESData.workOrders.map(order => `
                  <tr>
                    <td><strong>${order.id}</strong></td>
                    <td>${order.product}</td>
                    <td>${order.quantity} pcs</td>
                    <td>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="progress-enhanced" style="width: 120px;">
                          <div class="progress-indicator" style="width: ${order.progress}%; background: ${
                            order.progress === 100 ? 'linear-gradient(90deg, #10b981, #34d399)' :
                            order.progress >= 50 ? 'linear-gradient(90deg, #f59e0b, #fbbf24)' :
                            'linear-gradient(90deg, #6b7280, #9ca3af)'
                          };"></div>
                        </div>
                        <span style="font-size: 12px; color: var(--muted-foreground); font-weight: 500;">${order.progress}%</span>
                      </div>
                    </td>
                    <td><span class="badge badge-${
                      order.status === 'completed' ? 'success' :
                      order.status === 'in-progress' ? 'secondary' :
                      order.status === 'on-hold' ? 'warning' : 'default'
                    }">${order.status.replace('-', ' ')}</span></td>
                    <td>${new Date(order.dueDate).toLocaleDateString()}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    // Navigation function
    function navigateToView(viewId) {
      currentView = viewId;
      
      // Update active nav item
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.closest('.nav-item').classList.add('active');
      
      // Generate content based on view
      let content = '';
      switch(viewId) {
        case 'dashboard':
          content = generateModernDashboard();
          break;
        case 'worker-panel':
          content = generateWorkerPanel();
          break;
        case 'plan-designer':
          content = generatePlanDesigner();
          break;
        case 'templates':
          content = generateTemplates();
          break;
        case 'settings':
          content = generateSettings();
          break;
        case 'stations':
          content = generateStations();
          break;
        case 'operations':
          content = generateOperations();
          break;
        case 'workers':
          content = generateWorkers();
          break;
        default:
          content = generateModernDashboard();
      }
      
      document.getElementById('content-area').innerHTML = content;
    }

    // Worker Panel Generator
    function generateWorkerPanel() {
      return `
        <div style="margin-bottom: 24px;">
          <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">Worker Panel</h1>
          <p style="color: var(--muted-foreground);">Ä°ÅŸÃ§i atama ve takip sistemi</p>
        </div>

        <div class="grid grid-cols-3" style="margin-bottom: 32px;">
          <div class="card">
            <div class="card-content">
              <div class="card-title">Active Workers</div>
              <div class="kpi-value" style="color: #10b981;">8</div>
              <div style="font-size: 14px; color: var(--muted-foreground);">Currently working</div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-content">
              <div class="card-title">On Break</div>
              <div class="kpi-value" style="color: #f59e0b;">2</div>
              <div style="font-size: 14px; color: var(--muted-foreground);">Break time</div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-content">
              <div class="card-title">Efficiency</div>
              <div class="kpi-value" style="color: #3b82f6;">94%</div>
              <div style="font-size: 14px; color: var(--muted-foreground);">Today's average</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Worker Status</div>
            <div class="card-description">Real-time worker availability and task assignments</div>
          </div>
          <div class="card-content">
            <table class="table">
              <thead>
                <tr>
                  <th>Worker</th>
                  <th>Station</th>
                  <th>Current Task</th>
                  <th>Status</th>
                  <th>Completion</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Ali Kaya</strong></td>
                  <td>Station A</td>
                  <td>Welding - WO-001</td>
                  <td><span class="badge badge-success">Active</span></td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div class="progress" style="width: 100px;">
                        <div class="progress-indicator" style="width: 80%;"></div>
                      </div>
                      <span style="font-size: 12px;">80%</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td><strong>Mehmet YÄ±lmaz</strong></td>
                  <td>Station B</td>
                  <td>Cutting - WO-002</td>
                  <td><span class="badge badge-success">Active</span></td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div class="progress" style="width: 100px;">
                        <div class="progress-indicator" style="width: 45%;"></div>
                      </div>
                      <span style="font-size: 12px;">45%</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td><strong>Fatma Åahin</strong></td>
                  <td>Station C</td>
                  <td>Assembly - WO-003</td>
                  <td><span class="badge badge-warning">Break</span></td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div class="progress" style="width: 100px;">
                        <div class="progress-indicator" style="width: 60%;"></div>
                      </div>
                      <span style="font-size: 12px;">60%</span>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    // Settings Generator
    function generateSettings() {
      return `
        <div style="margin-bottom: 24px;">
          <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">Master Data</h1>
          <p style="color: var(--muted-foreground);">System configuration and setup</p>
        </div>

        <div class="grid grid-cols-2">
          <div class="card">
            <div class="card-header">
              <div class="card-title">System Configuration</div>
              <div class="card-description">Basic system settings</div>
            </div>
            <div class="card-content">
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Company Name</label>
                <input type="text" value="Burkol Metal" style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;" />
              </div>
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Working Hours</label>
                <input type="text" value="08:00 - 17:00" style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;" />
              </div>
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Time Zone</label>
                <select style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;">
                  <option>Europe/Istanbul</option>
                </select>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">Production Settings</div>
              <div class="card-description">Configure production parameters</div>
            </div>
            <div class="card-content">
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Default Priority</label>
                <select style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;">
                  <option>Normal</option>
                  <option>High</option>
                  <option>Low</option>
                </select>
              </div>
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Auto-Assignment</label>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <input type="checkbox" checked />
                  <span>Enable automatic worker assignment</span>
                </div>
              </div>
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Quality Check</label>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <input type="checkbox" checked />
                  <span>Require quality checks for all operations</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Workers Generator  
    function generateWorkers() {
      return `
        <div style="margin-bottom: 24px;">
          <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">Workers Management</h1>
          <p style="color: var(--muted-foreground);">Manage workers, skills and assignments</p>
        </div>

        <div style="margin-bottom: 24px;">
          <button onclick="alert('Add Worker functionality will be implemented')" style="background: var(--primary); color: var(--primary-foreground); padding: 12px 24px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">
            + Add Worker
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Worker List</div>
            <div class="card-description">Manage your workforce</div>
          </div>
          <div class="card-content">
            <table class="table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Skills</th>
                  <th>Shift</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Ali Kaya</strong><br><small>ali@burkol.com</small></td>
                  <td>
                    <span class="badge badge-outline">Welding</span>
                    <span class="badge badge-outline">Cutting</span>
                  </td>
                  <td>Day Shift</td>
                  <td><span class="badge badge-success">Available</span></td>
                  <td>
                    <button style="padding: 4px 8px; margin-right: 4px; border: 1px solid var(--border); background: white; border-radius: 4px; cursor: pointer;">Edit</button>
                    <button style="padding: 4px 8px; border: 1px solid #ef4444; background: white; color: #ef4444; border-radius: 4px; cursor: pointer;">Delete</button>
                  </td>
                </tr>
                <tr>
                  <td><strong>Mehmet YÄ±lmaz</strong><br><small>mehmet@burkol.com</small></td>
                  <td>
                    <span class="badge badge-outline">Assembly</span>
                    <span class="badge badge-outline">Quality Control</span>
                  </td>
                  <td>Day Shift</td>
                  <td><span class="badge badge-warning">Busy</span></td>
                  <td>
                    <button style="padding: 4px 8px; margin-right: 4px; border: 1px solid var(--border); background: white; border-radius: 4px; cursor: pointer;">Edit</button>
                    <button style="padding: 4px 8px; border: 1px solid #ef4444; background: white; color: #ef4444; border-radius: 4px; cursor: pointer;">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    // Operations Generator
    function generateOperations() {
      return `
        <div style="margin-bottom: 24px;">
          <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">Operations Management</h1>
          <p style="color: var(--muted-foreground);">Define and manage production operations</p>
        </div>

        <div style="margin-bottom: 24px;">
          <button onclick="alert('Add Operation functionality will be implemented')" style="background: var(--primary); color: var(--primary-foreground); padding: 12px 24px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">
            + Add Operation
          </button>
        </div>

        <div class="grid grid-cols-3">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Welding</div>
              <div class="card-description">Metal joining operations</div>
            </div>
            <div class="card-content">
              <div style="margin-bottom: 12px;">
                <strong>Duration:</strong> 30 min
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Required Skills:</strong>
                <div><span class="badge badge-outline">Welding</span></div>
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Quality Check:</strong> Required
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">Cutting</div>
              <div class="card-description">Material cutting operations</div>
            </div>
            <div class="card-content">
              <div style="margin-bottom: 12px;">
                <strong>Duration:</strong> 15 min
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Required Skills:</strong>
                <div><span class="badge badge-outline">Cutting</span></div>
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Quality Check:</strong> Optional
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">Assembly</div>
              <div class="card-description">Part assembly operations</div>
            </div>
            <div class="card-content">
              <div style="margin-bottom: 12px;">
                <strong>Duration:</strong> 45 min
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Required Skills:</strong>
                <div><span class="badge badge-outline">Assembly</span></div>
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Quality Check:</strong> Required
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Stations Generator
    function generateStations() {
      return '<div style="margin-bottom: 24px;">' +
        '<h1 style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">Stations Management</h1>' +
        '<p style="color: var(--muted-foreground);">Configure production stations and equipment</p>' +
      '</div>' +
      
      '<div style="margin-bottom: 24px;">' +
        '<button onclick="openAddStationModal()" style="background: var(--primary); color: var(--primary-foreground); padding: 12px 24px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">' +
          '+ Add Station' +
        '</button>' +
      '</div>' +
      
      '<div class="grid grid-cols-2 gap-6">' +
        MESData.stations.map(station => 
          '<div class="card">' +
            '<div class="card-header">' +
              '<div class="card-title">' + station.name + '</div>' +
              '<div class="card-description">' + station.description + '</div>' +
            '</div>' +
            '<div class="card-content">' +
              '<div style="margin-bottom: 12px;">' +
                '<strong>Status:</strong> <span class="badge badge-' + 
                (station.status === 'active' ? 'success' : 
                 station.status === 'maintenance' ? 'warning' : 'default') + '">' + 
                 station.status.charAt(0).toUpperCase() + station.status.slice(1) + '</span>' +
              '</div>' +
              '<div style="margin-bottom: 12px;">' +
                '<strong>Current Worker:</strong> ' + (station.currentWorker || 'Not assigned') +
              '</div>' +
              '<div style="margin-bottom: 12px;">' +
                '<strong>Current Operation:</strong> ' + (station.currentOperation || 'None') +
              '</div>' +
              '<div style="margin-bottom: 12px;">' +
                '<strong>Capabilities:</strong>' +
                '<div>' +
                  station.capabilities.map(cap => 
                    '<span class="badge badge-outline" style="margin-right: 4px;">' + cap + '</span>'
                  ).join('') +
                '</div>' +
              '</div>' +
              '<div style="margin-top: 16px; display: flex; gap: 8px;">' +
                '<button onclick="editStation(\'' + station.id + '\')" style="padding: 6px 12px; background: white; border: 1px solid var(--border); border-radius: 4px; cursor: pointer;">Edit</button>' +
                '<button onclick="toggleStationStatus(\'' + station.id + '\')" style="padding: 6px 12px; background: ' + 
                (station.status === 'active' ? '#f59e0b' : '#10b981') + '; color: white; border: none; border-radius: 4px; cursor: pointer;">' +
                (station.status === 'active' ? 'Maintenance' : 'Activate') + '</button>' +
                '<button onclick="deleteStation(\'' + station.id + '\')" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Delete</button>' +
              '</div>' +
            '</div>' +
          '</div>'
        ).join('') +
      '</div>' +
      
      '<!-- Add/Edit Station Modal -->' +
      '<div id="station-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;" onclick="closeStationModal(event)">' +
        '<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 8px; padding: 24px; width: 500px; max-height: 80vh; overflow-y: auto;">' +
          '<h3 id="station-modal-title" style="margin: 0 0 20px 0;">Add New Station</h3>' +
          '<div>' +
            '<div style="margin-bottom: 16px;">' +
              '<label style="display: block; margin-bottom: 8px; font-weight: 500;">Station Name</label>' +
              '<input type="text" id="station-name" placeholder="Enter station name" style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;" />' +
            '</div>' +
            '<div style="margin-bottom: 16px;">' +
              '<label style="display: block; margin-bottom: 8px; font-weight: 500;">Description</label>' +
              '<input type="text" id="station-description" placeholder="Enter description" style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;" />' +
            '</div>' +
            '<div style="margin-bottom: 16px;">' +
              '<label style="display: block; margin-bottom: 8px; font-weight: 500;">Location</label>' +
              '<input type="text" id="station-location" placeholder="Enter location" style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;" />' +
            '</div>' +
            '<div style="margin-bottom: 16px;">' +
              '<label style="display: block; margin-bottom: 8px; font-weight: 500;">Status</label>' +
              '<select id="station-status" style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;">' +
                '<option value="active">Active</option>' +
                '<option value="maintenance">Maintenance</option>' +
                '<option value="inactive">Inactive</option>' +
              '</select>' +
            '</div>' +
            '<div style="margin-bottom: 16px;">' +
              '<label style="display: block; margin-bottom: 8px; font-weight: 500;">Capabilities</label>' +
              '<div id="station-capabilities" style="border: 1px solid var(--border); border-radius: 6px; padding: 12px;">' +
                '<div style="margin-bottom: 8px;">' +
                  '<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" value="Welding"> Welding</label>' +
                '</div>' +
                '<div style="margin-bottom: 8px;">' +
                  '<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" value="Cutting"> Cutting</label>' +
                '</div>' +
                '<div style="margin-bottom: 8px;">' +
                  '<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" value="Assembly"> Assembly</label>' +
                '</div>' +
                '<div style="margin-bottom: 8px;">' +
                  '<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" value="Quality Control"> Quality Control</label>' +
                '</div>' +
                '<div style="margin-bottom: 8px;">' +
                  '<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" value="Packaging"> Packaging</label>' +
                '</div>' +
                '<div style="margin-bottom: 8px;">' +
                  '<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" value="Surface Treatment"> Surface Treatment</label>' +
                '</div>' +
                '<div style="margin-bottom: 8px;">' +
                  '<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" value="Painting"> Painting</label>' +
                '</div>' +
                '<div>' +
                  '<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" value="Drilling"> Drilling</label>' +
                '</div>' +
              '</div>' +
            '</div>' +
          '</div>' +
          '<div style="margin-top: 20px; display: flex; gap: 8px; justify-content: flex-end;">' +
            '<button onclick="closeStationModal()" style="padding: 8px 16px; background: white; border: 1px solid var(--border); border-radius: 4px; cursor: pointer;">Cancel</button>' +
            '<button onclick="saveStation()" style="padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>' +
          '</div>' +
        '</div>' +
      '</div>';
    }

    // Plan Designer Generator
    function generatePlanDesigner() {
      return `
        <div style="margin-bottom: 24px;">
          <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">Production Plan Designer</h1>
          <p style="color: var(--muted-foreground);">Create and manage production plans with drag & drop interface</p>
        </div>

        <!-- Plan Configuration Section (compact) -->
        <div class="card" style="margin-bottom: 12px;">
          <div class="card-header" style="padding: 10px 12px;">
            <div class="card-title" style="font-size: 16px;">Plan Configuration</div>
            <div class="card-description" style="font-size: 12px;">Set up your production plan</div>
          </div>
          <div class="card-content" style="padding: 8px 12px;">
            <div style="display: flex; gap: 8px; align-items: flex-end;">
              <div style="flex: 1; min-width: 140px;">
                <label style="display: block; font-weight: 500; font-size: 13px; margin-bottom: 4px;">Plan</label>
                <input type="text" id="plan-name" placeholder="Plan name" style="width: 100%; padding: 6px 8px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;" />
              </div>
              <div style="flex: 1; min-width: 180px;">
                <label style="display: block; font-weight: 500; font-size: 13px; margin-bottom: 4px;">Order</label>
                <select id="order-select" style="width: 100%; padding: 6px 8px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;" onchange="handleOrderChange()">
                  <option value="">Select an order...</option>
                  <option value="WO-2401">WO-2401 - Engine Block (500 units)</option>
                  <option value="WO-2402">WO-2402 - Gear Assembly (800 units)</option>
                  <option value="WO-2403">WO-2403 - Control Panel (300 units)</option>
                </select>
              </div>
              <div style="display:flex; gap:8px; align-items:center;">
                <button onclick="savePlanAsTemplate()" style="padding:6px 10px; font-size:13px; border-radius:6px; border:1px solid var(--border); background: white;">Save</button>
                <button onclick="deployWorkOrder()" style="padding:6px 10px; font-size:13px; border-radius:6px; background: var(--primary); color: var(--primary-foreground); border: none;">Deploy</button>
              </div>
            </div>
            <div style="margin-top:8px;">
              <label style="display:block; font-weight:500; font-size:13px; margin-bottom:4px;">Description</label>
              <textarea id="plan-description" placeholder="Plan description..." style="width:100%; padding:6px 8px; border:1px solid var(--border); border-radius:6px; min-height:42px; font-size:13px; resize:vertical;"></textarea>
            </div>
          </div>
        </div>

        <!-- Main Design Area -->
        <div style="display: grid; grid-template-columns: 240px 1fr; gap: 16px; height: 500px;">
          
          <!-- Left Panel - Operations Toolbox -->
          <div class="card" style="height: fit-content;">
            <div class="card-header" style="padding: 8px 12px;">
              <div class="card-title" style="font-size: 14px;">Operations</div>
              <div class="card-description" style="font-size: 11px;">Drag to canvas</div>
            </div>
            <div class="card-content" style="padding: 8px;">
              <div id="operations-list">
                <!-- Operations will be loaded here -->
              </div>
            </div>
          </div>

          <!-- Right Panel - Design Canvas -->
          <div class="card">
            <div class="card-header" style="padding: 8px 12px;">
              <div class="card-title" style="font-size: 14px;">Plan Canvas</div>
              <div class="card-description">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <span style="font-size: 11px;">Design your production flow</span>
                  <div style="display: flex; gap: 6px;">
                    <button id="connect-mode-btn" onclick="toggleConnectMode()" style="padding: 3px 6px; background: white; border: 1px solid var(--border); border-radius: 3px; cursor: pointer; font-size: 11px;">
                      ğŸ”— Connect
                    </button>
                    <button onclick="clearCanvas()" style="padding: 3px 6px; background: white; border: 1px solid var(--border); border-radius: 3px; cursor: pointer; font-size: 11px;">
                      ğŸ—‘ï¸ Clear
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-content" style="padding: 0; height: 420px; position: relative; overflow: hidden;">
              <div id="plan-canvas" 
                   style="width: 100%; height: 100%; position: relative; background: var(--card); border: 1px solid var(--border);"
                   ondrop="handleCanvasDrop(event)" 
                   ondragover="handleCanvasDragOver(event)"
                   onclick="handleCanvasClick(event)">
                <!-- Grid pattern -->
                <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(circle, #ccc 1px, transparent 1px); background-size: 20px 20px; opacity: 0.3; pointer-events: none;"></div>
                <!-- Canvas nodes will be added here -->
              </div>
            </div>
          </div>
        </div>

        <!-- Node Edit Modal -->
        <div id="node-edit-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;" onclick="closeNodeEditModal(event)">
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 8px; padding: 24px; width: 400px; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 0 0 16px 0;">Edit Operation</h3>
            <div id="node-edit-form">
              <!-- Form content will be populated dynamically -->
            </div>
            <div style="margin-top: 20px; display: flex; gap: 8px; justify-content: flex-end;">
              <button onclick="closeNodeEditModal()" style="padding: 8px 16px; background: white; border: 1px solid var(--border); border-radius: 4px; cursor: pointer;">Cancel</button>
              <button onclick="saveNodeEdit()" style="padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
            </div>
          </div>
        </div>
      `;
    }

    // Templates Generator
    function generateTemplates() {
      return `
        <div style="margin-bottom: 24px;">
          <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">Production Templates</h1>
          <p style="color: var(--muted-foreground);">Reusable production plan templates</p>
        </div>

        <div style="margin-bottom: 24px;">
          <button onclick="alert('Create Template functionality will be implemented')" style="background: var(--primary); color: var(--primary-foreground); padding: 12px 24px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">
            + Create Template
          </button>
        </div>

        <div class="grid grid-cols-3">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Standard Bracket Production</div>
              <div class="card-description">Standard metal bracket manufacturing</div>
            </div>
            <div class="card-content">
              <div style="margin-bottom: 12px;">
                <strong>Operations:</strong> 3
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Duration:</strong> 90 min
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Skills Required:</strong>
                <div>
                  <span class="badge badge-outline">Cutting</span>
                  <span class="badge badge-outline">Welding</span>
                </div>
              </div>
              <div style="margin-top: 16px;">
                <button style="padding: 8px 16px; background: white; border: 1px solid var(--border); border-radius: 4px; margin-right: 8px; cursor: pointer;">Use Template</button>
                <button style="padding: 8px 16px; background: white; border: 1px solid var(--border); border-radius: 4px; cursor: pointer;">Edit</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">Custom Assembly Process</div>
              <div class="card-description">Multi-component assembly workflow</div>
            </div>
            <div class="card-content">
              <div style="margin-bottom: 12px;">
                <strong>Operations:</strong> 5
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Duration:</strong> 150 min
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Skills Required:</strong>
                <div>
                  <span class="badge badge-outline">Assembly</span>
                  <span class="badge badge-outline">Quality Control</span>
                </div>
              </div>
              <div style="margin-top: 16px;">
                <button style="padding: 8px 16px; background: white; border: 1px solid var(--border); border-radius: 4px; margin-right: 8px; cursor: pointer;">Use Template</button>
                <button style="padding: 8px 16px; background: white; border: 1px solid var(--border); border-radius: 4px; cursor: pointer;">Edit</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">Quality Inspection</div>
              <div class="card-description">Comprehensive quality check process</div>
            </div>
            <div class="card-content">
              <div style="margin-bottom: 12px;">
                <strong>Operations:</strong> 2
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Duration:</strong> 30 min
              </div>
              <div style="margin-bottom: 12px;">
                <strong>Skills Required:</strong>
                <div>
                  <span class="badge badge-outline">Quality Control</span>
                </div>
              </div>
              <div style="margin-top: 16px;">
                <button style="padding: 8px 16px; background: white; border: 1px solid var(--border); border-radius: 4px; margin-right: 8px; cursor: pointer;">Use Template</button>
                <button style="padding: 8px 16px; background: white; border: 1px solid var(--border); border-radius: 4px; cursor: pointer;">Edit</button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Initialize dashboard on load
    document.addEventListener('DOMContentLoaded', function() {
      navigateToView('dashboard');
    });

    // Mobile Navigation Functions
    function toggleMobileNav() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.querySelector('.mobile-overlay');
      
      sidebar.classList.toggle('mobile-open');
      overlay.classList.toggle('active');
    }

    function closeMobileNav() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.querySelector('.mobile-overlay');
      
      sidebar.classList.remove('mobile-open');
      overlay.classList.remove('active');
    }

    // Close mobile nav when navigation item is clicked
    function navigateToView(viewId) {
      currentView = viewId;
      
      // Close mobile nav if open
      closeMobileNav();
      
      // Update active nav item
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      
      // Find and activate the correct nav item
      const clickedItem = document.querySelector('[onclick="navigateToView(\'' + viewId + '\')"]');
      if (clickedItem) {
        clickedItem.classList.add('active');
      }
      
      // Generate content based on view
      let content = '';
      switch(viewId) {
        case 'dashboard':
          content = generateModernDashboard();
          break;
        case 'worker-panel':
          content = generateWorkerPanel();
          break;
        case 'plan-designer':
          content = generatePlanDesigner();
          setTimeout(() => initializePlanDesigner(), 100);
          break;
        case 'templates':
          content = generateTemplates();
          break;
        case 'settings':
          content = generateSettings();
          break;
        case 'stations':
          content = generateStations();
          break;
        case 'operations':
          content = generateOperations();
          break;
        case 'workers':
          content = generateWorkers();
          break;
        default:
          content = generateModernDashboard();
      }
      
      document.getElementById('content-area').innerHTML = content;
    }

    // Help System Functions
    function openHelp() {
      document.getElementById('help-overlay').classList.add('active');
      document.getElementById('help-panel').classList.add('active');
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
    }

    // Plan Designer State and Functions
    let planDesignerState = {
      nodes: [],
      connectMode: false,
      connectingFrom: null,
      draggedOperation: null,
      selectedNode: null,
      nodeIdCounter: 1
    };

    // Load operations into toolbox
    function loadOperationsToolbox() {
      const operations = [
        { id: 'op1', name: 'CNC Milling', type: 'Machining', time: 45, skills: ['CNC Programming', 'CAM Software'] },
        { id: 'op2', name: 'MIG Welding', type: 'Welding', time: 30, skills: ['MIG Welding', 'Blueprint Reading'] },
        { id: 'op3', name: 'Quality Control', type: 'Quality', time: 20, skills: ['Quality Inspection', 'Measurement'] },
        { id: 'op4', name: 'Assembly', type: 'Assembly', time: 25, skills: ['Assembly', 'Hand Tools'] },
        { id: 'op5', name: 'Packaging', type: 'Packaging', time: 15, skills: ['Packaging'] },
        { id: 'op6', name: 'Surface Treatment', type: 'Treatment', time: 40, skills: ['Surface Treatment'] },
        { id: 'op7', name: 'Drilling', type: 'Machining', time: 20, skills: ['Drilling', 'Precision Tools'] },
        { id: 'op8', name: 'Painting', type: 'Finishing', time: 35, skills: ['Painting', 'Spray Equipment'] }
      ];

      const listContainer = document.getElementById('operations-list');
      if (!listContainer) return;

      listContainer.innerHTML = operations.map(op => 
        '<div draggable="true" ' +
             'ondragstart="handleOperationDragStart(event, \'' + op.id + '\')" ' +
             'style="padding: 6px 8px; border: 1px solid var(--border); border-radius: 4px; cursor: grab; background: white; margin-bottom: 4px; font-size: 13px; font-weight: 500;" ' +
             'onmouseover="this.style.background=\'var(--muted)\'" ' + 
             'onmouseout="this.style.background=\'white\'">' +
          op.name +
        '</div>'
      ).join('');
    }

    function handleOperationDragStart(event, operationId) {
      planDesignerState.draggedOperation = operationId;
      event.dataTransfer.effectAllowed = 'copy';
    }

    function handleCanvasDragOver(event) {
      event.preventDefault();
      event.dataTransfer.dropEffect = 'copy';
    }

    function handleCanvasDrop(event) {
      event.preventDefault();
      if (!planDesignerState.draggedOperation) return;

      const canvas = document.getElementById('plan-canvas');
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left - 80; // Center the node
      const y = event.clientY - rect.top - 40;

      const operations = [
        { id: 'op1', name: 'CNC Milling', type: 'Machining', time: 45, skills: ['CNC Programming', 'CAM Software'] },
        { id: 'op2', name: 'MIG Welding', type: 'Welding', time: 30, skills: ['MIG Welding', 'Blueprint Reading'] },
        { id: 'op3', name: 'Quality Control', type: 'Quality', time: 20, skills: ['Quality Inspection', 'Measurement'] },
        { id: 'op4', name: 'Assembly', type: 'Assembly', time: 25, skills: ['Assembly', 'Hand Tools'] },
        { id: 'op5', name: 'Packaging', type: 'Packaging', time: 15, skills: ['Packaging'] },
        { id: 'op6', name: 'Surface Treatment', type: 'Treatment', time: 40, skills: ['Surface Treatment'] },
        { id: 'op7', name: 'Drilling', type: 'Machining', time: 20, skills: ['Drilling', 'Precision Tools'] },
        { id: 'op8', name: 'Painting', type: 'Finishing', time: 35, skills: ['Painting', 'Spray Equipment'] }
      ];

      const operation = operations.find(op => op.id === planDesignerState.draggedOperation);
      if (!operation) return;

      const nodeId = 'node-' + planDesignerState.nodeIdCounter++;
      const newNode = {
        id: nodeId,
        operationId: operation.id,
        name: operation.name,
        type: operation.type,
        time: operation.time,
        skills: operation.skills,
        x: Math.max(0, x),
        y: Math.max(0, y),
        connections: [],
        assignedWorker: null,
        assignedStation: null
      };

      planDesignerState.nodes.push(newNode);
      renderCanvas();
      planDesignerState.draggedOperation = null;
      
      showToast(operation.name + ' operasyonu eklendi', 'success');
    }

    function renderCanvas() {
      const canvas = document.getElementById('plan-canvas');
      if (!canvas) return;

      // Clear existing nodes and connections (keep grid)
      const existingElements = canvas.querySelectorAll('.canvas-node, .connection-container');
      existingElements.forEach(element => element.remove());

      // Render connections first (so they appear behind nodes)
      planDesignerState.nodes.forEach(node => {
        node.connections.forEach(targetId => {
          const targetNode = planDesignerState.nodes.find(n => n.id === targetId);
          if (targetNode) {
            renderConnection(node, targetNode);
          }
        });
      });

      // Render nodes
      planDesignerState.nodes.forEach(node => {
        renderNode(node);
      });
    }

    function renderNode(node) {
      const canvas = document.getElementById('plan-canvas');
      const colors = {
        'Machining': '#3b82f6',
        'Welding': '#ef4444', 
        'Quality': '#10b981',
        'Assembly': '#8b5cf6',
        'Packaging': '#f97316',
        'Treatment': '#06b6d4',
        'Finishing': '#ec4899'
      };

      const nodeElement = document.createElement('div');
      nodeElement.className = 'canvas-node';
      nodeElement.id = 'node-' + node.id;
      nodeElement.style.cssText = 
        'position: absolute;' +
        'left: ' + node.x + 'px;' +
        'top: ' + node.y + 'px;' +
        'width: 160px;' +
        'min-height: 80px;' +
        'background: white;' +
        'border: 2px solid ' + (colors[node.type] || '#6b7280') + ';' +
        'border-radius: 8px;' +
        'padding: 8px;' +
        'cursor: move;' +
        'box-shadow: 0 2px 4px rgba(0,0,0,0.1);' +
        'z-index: 10;' +
        'user-select: none;';

      nodeElement.innerHTML = 
        '<div style="display: flex; justify-content: between; align-items: flex-start; margin-bottom: 4px;">' +
          '<div class="drag-handle" style="font-weight: 600; font-size: 14px; color: ' + (colors[node.type] || '#6b7280') + '; flex: 1; cursor: move; padding: 2px;">' +
            'ğŸ”¸ ' + node.name +
          '</div>' +
          '<div style="display: flex; gap: 2px;">' +
            '<button onclick="event.stopPropagation(); editNode(\'' + node.id + '\')" style="width: 20px; height: 20px; border: none; background: #f3f4f6; border-radius: 3px; cursor: pointer; font-size: 10px;">âœï¸</button>' +
            '<button onclick="event.stopPropagation(); deleteNode(\'' + node.id + '\')" style="width: 20px; height: 20px; border: none; background: #fee2e2; border-radius: 3px; cursor: pointer; font-size: 10px;">ğŸ—‘ï¸</button>' +
          '</div>' +
        '</div>' +
        '<div style="font-size: 11px; color: #6b7280; margin-bottom: 2px;">Type: ' + node.type + '</div>' +
        '<div style="font-size: 11px; color: #6b7280; margin-bottom: 2px;">â±ï¸ ' + node.time + ' min</div>' +
        '<div style="font-size: 10px; color: #9ca3af;">' +
          'Worker: ' + (node.assignedWorker || 'Not assigned') + '<br>' +
          'Station: ' + (node.assignedStation || 'Not assigned') +
        '</div>';

      // Add drag functionality
      let isDragging = false;
      let dragStartX = 0;
      let dragStartY = 0;
      let nodeStartX = node.x;
      let nodeStartY = node.y;

      nodeElement.onmousedown = (e) => {
        if (e.target.closest('button')) return; // Don't drag when clicking buttons
        
        if (planDesignerState.connectMode) {
          handleNodeClick(node.id);
          return;
        }

        isDragging = true;
        dragStartX = e.clientX;
        dragStartY = e.clientY;
        nodeStartX = node.x;
        nodeStartY = node.y;
        
        nodeElement.style.zIndex = '20';
        nodeElement.style.transform = 'scale(1.05)';
        
        e.preventDefault();
      };

      document.onmousemove = (e) => {
        if (!isDragging) return;
        
        const deltaX = e.clientX - dragStartX;
        const deltaY = e.clientY - dragStartY;
        
        const newX = Math.max(0, nodeStartX + deltaX);
        const newY = Math.max(0, nodeStartY + deltaY);
        
        node.x = newX;
        node.y = newY;
        
        nodeElement.style.left = newX + 'px';
        nodeElement.style.top = newY + 'px';
        
        // Update connections in real-time
        updateConnectionsForNode(node.id);
      };

      document.onmouseup = () => {
        if (isDragging) {
          isDragging = false;
          nodeElement.style.zIndex = '10';
          nodeElement.style.transform = 'scale(1)';
        }
      };

      nodeElement.onclick = (e) => {
        e.stopPropagation();
        if (!isDragging) {
          handleNodeClick(node.id);
        }
      };

      canvas.appendChild(nodeElement);
    }

    function renderConnection(fromNode, toNode) {
      const canvas = document.getElementById('plan-canvas');
      
      const connectionId = 'connection-' + fromNode.id + '-' + toNode.id;
      
      // Create connection container
      const connectionContainer = document.createElement('div');
      connectionContainer.className = 'connection-container';
      connectionContainer.id = connectionId;
      connectionContainer.style.cssText = 
        'position: absolute;' +
        'pointer-events: none;' +
        'z-index: 5;';
      
      const fromX = fromNode.x + 80; // center of node
      const fromY = fromNode.y + 40;
      const toX = toNode.x + 80;
      const toY = toNode.y + 40;
      
      const length = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
      const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;
      
      // Create the main line
      const line = document.createElement('div');
      line.className = 'connection-line';
      line.style.cssText = 
        'position: absolute;' +
        'left: ' + fromX + 'px;' +
        'top: ' + fromY + 'px;' +
        'width: ' + (length - 10) + 'px;' +
        'height: 3px;' +
        'background: #6b7280;' +
        'transform-origin: 0 50%;' +
        'transform: rotate(' + angle + 'deg);' +
        'pointer-events: auto;' +
        'cursor: pointer;' +
        'border-radius: 2px;';
      
      // Create middle arrow (triangle on the line)
      const middleArrow = document.createElement('div');
      middleArrow.className = 'middle-arrow';
      const middleX = fromX + (toX - fromX) / 2;
      const middleY = fromY + (toY - fromY) / 2;
      middleArrow.style.cssText = 
        'position: absolute;' +
        'left: ' + (middleX - 6) + 'px;' +
        'top: ' + (middleY - 4) + 'px;' +
        'width: 0;' +
        'height: 0;' +
        'border-left: 6px solid #6b7280;' +
        'border-top: 4px solid transparent;' +
        'border-bottom: 4px solid transparent;' +
        'transform: rotate(' + angle + 'deg);' +
        'transform-origin: 50% 50%;' +
        'pointer-events: auto;' +
        'cursor: pointer;' +
        'z-index: 6;';
      
      // Create arrow head at the end
      const arrowHead = document.createElement('div');
      arrowHead.className = 'arrow-head';
      arrowHead.style.cssText = 
        'position: absolute;' +
        'left: ' + (toX - 8) + 'px;' +
        'top: ' + (toY - 4) + 'px;' +
        'width: 0;' +
        'height: 0;' +
        'border-left: 8px solid #6b7280;' +
        'border-top: 4px solid transparent;' +
        'border-bottom: 4px solid transparent;' +
        'transform: rotate(' + angle + 'deg);' +
        'transform-origin: -4px 50%;' +
        'pointer-events: auto;' +
        'cursor: pointer;';
      
      // Create delete button (initially hidden)
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'connection-delete-btn';
      deleteBtn.innerHTML = 'âœ•';
      deleteBtn.style.cssText = 
        'position: absolute;' +
        'left: ' + (fromX + (toX - fromX) / 2 - 10) + 'px;' +
        'top: ' + (fromY + (toY - fromY) / 2 - 10) + 'px;' +
        'width: 20px;' +
        'height: 20px;' +
        'border: none;' +
        'background: #ef4444;' +
        'color: white;' +
        'border-radius: 50%;' +
        'cursor: pointer;' +
        'font-size: 12px;' +
        'font-weight: bold;' +
        'display: none;' +
        'z-index: 15;' +
        'box-shadow: 0 2px 4px rgba(0,0,0,0.2);';
      
      // Hover events for showing/hiding delete button
      const showDeleteBtn = () => {
        deleteBtn.style.display = 'block';
        line.style.background = '#ef4444';
        arrowHead.style.borderLeftColor = '#ef4444';
        middleArrow.style.borderLeftColor = '#ef4444';
      };
      
      const hideDeleteBtn = () => {
        deleteBtn.style.display = 'none';
        line.style.background = '#6b7280';
        arrowHead.style.borderLeftColor = '#6b7280';
        middleArrow.style.borderLeftColor = '#6b7280';
      };
      
      line.onmouseenter = showDeleteBtn;
      line.onmouseleave = hideDeleteBtn;
      arrowHead.onmouseenter = showDeleteBtn;
      arrowHead.onmouseleave = hideDeleteBtn;
      middleArrow.onmouseenter = showDeleteBtn;
      middleArrow.onmouseleave = hideDeleteBtn;
      deleteBtn.onmouseenter = showDeleteBtn;
      deleteBtn.onmouseleave = hideDeleteBtn;
      
      // Delete connection functionality
      deleteBtn.onclick = (e) => {
        e.stopPropagation();
        deleteConnection(fromNode.id, toNode.id);
      };
      
      // Add elements to container
      connectionContainer.appendChild(line);
      connectionContainer.appendChild(middleArrow);
      connectionContainer.appendChild(arrowHead);
      connectionContainer.appendChild(deleteBtn);
      
      canvas.appendChild(connectionContainer);
    }

    function updateConnectionsForNode(nodeId) {
      // Remove existing connections for this node
      const canvas = document.getElementById('plan-canvas');
      const existingConnections = canvas.querySelectorAll('.connection-container');
      existingConnections.forEach(conn => {
        if (conn.id.includes(nodeId)) {
          conn.remove();
        }
      });
      
      // Re-render all connections
      planDesignerState.nodes.forEach(node => {
        node.connections.forEach(targetId => {
          const targetNode = planDesignerState.nodes.find(n => n.id === targetId);
          if (targetNode) {
            renderConnection(node, targetNode);
          }
        });
      });
    }

    function deleteConnection(fromNodeId, toNodeId) {
      const fromNode = planDesignerState.nodes.find(n => n.id === fromNodeId);
      if (fromNode) {
        fromNode.connections = fromNode.connections.filter(id => id !== toNodeId);
        renderCanvas();
        showToast('Connection deleted', 'success');
      }
    }

    function handleNodeClick(nodeId) {
      if (planDesignerState.connectMode) {
        if (planDesignerState.connectingFrom === null) {
          planDesignerState.connectingFrom = nodeId;
          showToast('Select target operation to connect', 'info');
        } else if (planDesignerState.connectingFrom !== nodeId) {
          connectNodes(planDesignerState.connectingFrom, nodeId);
          planDesignerState.connectingFrom = null;
          planDesignerState.connectMode = false;
          updateConnectButton();
        }
      }
    }

    function connectNodes(fromId, toId) {
      const fromNode = planDesignerState.nodes.find(n => n.id === fromId);
      if (fromNode && !fromNode.connections.includes(toId)) {
        fromNode.connections.push(toId);
        renderCanvas();
        showToast('Operations connected', 'success');
      }
    }

    function toggleConnectMode() {
      planDesignerState.connectMode = !planDesignerState.connectMode;
      planDesignerState.connectingFrom = null;
      updateConnectButton();
      
      if (planDesignerState.connectMode) {
        showToast('Connect mode active. Click source operation, then target operation.', 'info');
      }
    }

    function updateConnectButton() {
      const btn = document.getElementById('connect-mode-btn');
      if (btn) {
        btn.style.background = planDesignerState.connectMode ? 'var(--primary)' : 'white';
        btn.style.color = planDesignerState.connectMode ? 'white' : 'black';
        btn.innerHTML = planDesignerState.connectMode ? 'ğŸ”— Connecting...' : 'ğŸ”— Connect';
      }
    }

    function clearCanvas() {
      if (planDesignerState.nodes.length === 0) {
        showToast('Canvas is already empty', 'info');
        return;
      }
      
      if (confirm('Are you sure you want to clear all operations?')) {
        planDesignerState.nodes = [];
        planDesignerState.connectMode = false;
        planDesignerState.connectingFrom = null;
        updateConnectButton();
        renderCanvas();
        showToast('Canvas cleared', 'success');
      }
    }

    function editNode(nodeId) {
      const node = planDesignerState.nodes.find(n => n.id === nodeId);
      if (!node) return;

      planDesignerState.selectedNode = node;
      
      const workers = [
        { id: 'w1', name: 'Ali YÄ±lmaz', skills: ['CNC Programming', 'CAM Software'] },
        { id: 'w2', name: 'Ahmet Can', skills: ['MIG Welding', 'Blueprint Reading'] },
        { id: 'w3', name: 'Fatma Ã–z', skills: ['Quality Inspection', 'Measurement'] },
        { id: 'w4', name: 'Mehmet Acar', skills: ['Assembly', 'Hand Tools'] }
      ];

      const stations = [
        { id: 's1', name: 'CNC Mill 01', type: 'Machining' },
        { id: 's2', name: 'Welding Station 01', type: 'Welding' },
        { id: 's3', name: 'QC Station 01', type: 'Quality' },
        { id: 's4', name: 'Assembly Line 01', type: 'Assembly' }
      ];

      const compatibleWorkers = workers.filter(w => 
        node.skills.some(skill => w.skills.includes(skill))
      );

      const compatibleStations = stations.filter(s => 
        s.type === node.type
      );

      const formContent = 
        '<div style="margin-bottom: 16px;">' +
          '<label style="display: block; margin-bottom: 4px; font-weight: 500;">Operation Name</label>' +
          '<input type="text" id="edit-name" value="' + node.name + '" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;" />' +
        '</div>' +
        '<div style="margin-bottom: 16px;">' +
          '<label style="display: block; margin-bottom: 4px; font-weight: 500;">Estimated Time (minutes)</label>' +
          '<input type="number" id="edit-time" value="' + node.time + '" min="1" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;" />' +
        '</div>' +
        '<div style="margin-bottom: 16px;">' +
          '<label style="display: block; margin-bottom: 4px; font-weight: 500;">Assigned Worker</label>' +
          '<select id="edit-worker" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;">' +
            '<option value="">Not assigned</option>' +
            compatibleWorkers.map(w => 
              '<option value="' + w.name + '" ' + (node.assignedWorker === w.name ? 'selected' : '') + '>' + w.name + '</option>'
            ).join('') +
          '</select>' +
        '</div>' +
        '<div style="margin-bottom: 16px;">' +
          '<label style="display: block; margin-bottom: 4px; font-weight: 500;">Assigned Station</label>' +
          '<select id="edit-station" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px;">' +
            '<option value="">Not assigned</option>' +
            compatibleStations.map(s => 
              '<option value="' + s.name + '" ' + (node.assignedStation === s.name ? 'selected' : '') + '>' + s.name + '</option>'
            ).join('') +
          '</select>' +
        '</div>' +
        '<div style="margin-bottom: 16px;">' +
          '<label style="display: block; margin-bottom: 4px; font-weight: 500;">Required Skills</label>' +
          '<div style="font-size: 12px; color: var(--muted-foreground);">' +
            node.skills.join(', ') +
          '</div>' +
        '</div>';

      document.getElementById('node-edit-form').innerHTML = formContent;
      document.getElementById('node-edit-modal').style.display = 'block';
    }

    function saveNodeEdit() {
      if (!planDesignerState.selectedNode) return;

      const name = document.getElementById('edit-name').value;
      const time = parseInt(document.getElementById('edit-time').value);
      const worker = document.getElementById('edit-worker').value;
      const station = document.getElementById('edit-station').value;

      if (!name || !time || time < 1) {
        showToast('Please fill all required fields', 'error');
        return;
      }

      planDesignerState.selectedNode.name = name;
      planDesignerState.selectedNode.time = time;
      planDesignerState.selectedNode.assignedWorker = worker || null;
      planDesignerState.selectedNode.assignedStation = station || null;

      renderCanvas();
      closeNodeEditModal();
      showToast('Operation updated', 'success');
    }

    function closeNodeEditModal(event) {
      if (event && event.target !== event.currentTarget) return;
      document.getElementById('node-edit-modal').style.display = 'none';
      planDesignerState.selectedNode = null;
    }

    function deleteNode(nodeId) {
      if (confirm('Are you sure you want to delete this operation?')) {
        planDesignerState.nodes = planDesignerState.nodes.filter(n => n.id !== nodeId);
        
        // Remove connections to this node
        planDesignerState.nodes.forEach(node => {
          node.connections = node.connections.filter(connId => connId !== nodeId);
        });
        
        renderCanvas();
        showToast('Operation deleted', 'success');
      }
    }

    function handleOrderChange() {
      const select = document.getElementById('order-select');
      const selectedOrder = select.value;
      
      if (selectedOrder) {
        const orderData = {
          'WO-2401': { product: 'Engine Block', quantity: 500, dueDate: '2025-02-15' },
          'WO-2402': { product: 'Gear Assembly', quantity: 800, dueDate: '2025-02-20' },
          'WO-2403': { product: 'Control Panel', quantity: 300, dueDate: '2025-02-18' }
        };
        
        const order = orderData[selectedOrder];
        if (order) {
          showToast('Selected: ' + order.product + ' (' + order.quantity + ' units, due ' + order.dueDate + ')', 'info');
        }
      }
    }

    function savePlanAsTemplate() {
      if (planDesignerState.nodes.length === 0) {
        showToast('Cannot save empty plan as template', 'error');
        return;
      }

      const planName = document.getElementById('plan-name').value;
      if (!planName) {
        showToast('Please enter a plan name', 'error');
        return;
      }

      // In a real app, this would save to backend
      showToast('Plan "' + planName + '" saved as template', 'success');
    }

    function deployWorkOrder() {
      if (planDesignerState.nodes.length === 0) {
        showToast('Cannot deploy empty plan', 'error');
        return;
      }

      const planName = document.getElementById('plan-name').value;
      const selectedOrder = document.getElementById('order-select').value;
      
      if (!planName) {
        showToast('Please enter a plan name', 'error');
        return;
      }

      if (!selectedOrder) {
        showToast('Please select an order', 'error');
        return;
      }

      // Check if all operations have assigned workers
      const unassignedOps = planDesignerState.nodes.filter(n => !n.assignedWorker);
      if (unassignedOps.length > 0) {
        showToast(unassignedOps.length + ' operations need worker assignment', 'warning');
        return;
      }

      // Calculate total time
      const totalTime = planDesignerState.nodes.reduce((sum, n) => sum + n.time, 0);
      
      showToast('Work Order deployed successfully! Total estimated time: ' + totalTime + ' minutes', 'success');
      
      // Clear the designer
      planDesignerState.nodes = [];
      document.getElementById('plan-name').value = '';
      document.getElementById('plan-description').value = '';
      document.getElementById('order-select').value = '';
      renderCanvas();
    }

    function handleCanvasClick(event) {
      if (planDesignerState.connectMode && event.target.id === 'plan-canvas') {
        planDesignerState.connectMode = false;
        planDesignerState.connectingFrom = null;
        updateConnectButton();
        showToast('Connect mode cancelled', 'info');
      }
    }

    // Toast notification system
    function showToast(message, type = 'info') {
      const colors = {
        success: '#10b981',
        error: '#ef4444',
        warning: '#f59e0b',
        info: '#3b82f6'
      };

      const toast = document.createElement('div');
      toast.style.cssText = 
        'position: fixed;' +
        'top: 20px;' +
        'right: 20px;' +
        'background: ' + colors[type] + ';' +
        'color: white;' +
        'padding: 12px 20px;' +
        'border-radius: 6px;' +
        'font-weight: 500;' +
        'z-index: 10000;' +
        'box-shadow: 0 4px 6px rgba(0,0,0,0.1);' +
        'animation: slideInRight 0.3s ease;';
      toast.textContent = message;

      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // Initialize Plan Designer when switching to that view
    function initializePlanDesigner() {
      setTimeout(() => {
        loadOperationsToolbox();
        renderCanvas();
      }, 100);
    }

    // Station Management Functions
    let editingStationId = null;

    function openAddStationModal() {
      editingStationId = null;
      document.getElementById('station-modal-title').textContent = 'Add New Station';
      
      // Clear form
      document.getElementById('station-name').value = '';
      document.getElementById('station-description').value = '';
      document.getElementById('station-location').value = '';
      document.getElementById('station-status').value = 'active';
      
      // Clear capabilities checkboxes
      document.querySelectorAll('#station-capabilities input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
      });
      
      document.getElementById('station-modal').style.display = 'block';
    }

    function editStation(stationId) {
      editingStationId = stationId;
      const station = MESData.stations.find(s => s.id === stationId);
      if (!station) return;
      
      document.getElementById('station-modal-title').textContent = 'Edit Station';
      
      // Fill form with station data
      document.getElementById('station-name').value = station.name;
      document.getElementById('station-description').value = station.description;
      document.getElementById('station-location').value = station.location || '';
      document.getElementById('station-status').value = station.status;
      
      // Set capabilities checkboxes
      document.querySelectorAll('#station-capabilities input[type="checkbox"]').forEach(cb => {
        cb.checked = station.capabilities.includes(cb.value);
      });
      
      document.getElementById('station-modal').style.display = 'block';
    }

    function closeStationModal(event) {
      if (event && event.target !== event.currentTarget) return;
      document.getElementById('station-modal').style.display = 'none';
      editingStationId = null;
    }

    function saveStation() {
      const name = document.getElementById('station-name').value.trim();
      const description = document.getElementById('station-description').value.trim();
      const location = document.getElementById('station-location').value.trim();
      const status = document.getElementById('station-status').value;
      
      if (!name || !description) {
        alert('Please fill in all required fields');
        return;
      }
      
      // Get selected capabilities
      const capabilities = Array.from(document.querySelectorAll('#station-capabilities input[type="checkbox"]:checked'))
        .map(cb => cb.value);
      
      if (capabilities.length === 0) {
        alert('Please select at least one capability');
        return;
      }
      
      if (editingStationId) {
        // Edit existing station
        const stationIndex = MESData.stations.findIndex(s => s.id === editingStationId);
        if (stationIndex !== -1) {
          MESData.stations[stationIndex] = {
            ...MESData.stations[stationIndex],
            name,
            description,
            location,
            status,
            capabilities
          };
        }
      } else {
        // Add new station
        const newStation = {
          id: 'ST-' + Date.now(),
          name,
          description,
          location,
          status,
          capabilities,
          currentWorker: null,
          currentOperation: null
        };
        MESData.stations.push(newStation);
      }
      
      saveData();
      closeStationModal();
      navigateToView('stations'); // Refresh the view
      showToast((editingStationId ? 'Station updated' : 'Station added') + ' successfully', 'success');
    }

    function toggleStationStatus(stationId) {
      const station = MESData.stations.find(s => s.id === stationId);
      if (!station) return;
      
      station.status = station.status === 'active' ? 'maintenance' : 'active';
      
      // If setting to maintenance, clear current assignments
      if (station.status === 'maintenance') {
        station.currentWorker = null;
        station.currentOperation = null;
      }
      
      saveData();
      navigateToView('stations'); // Refresh the view
      showToast('Station status updated', 'success');
    }

    function deleteStation(stationId) {
      if (!confirm('Are you sure you want to delete this station? This action cannot be undone.')) {
        return;
      }
      
      const stationIndex = MESData.stations.findIndex(s => s.id === stationId);
      if (stationIndex !== -1) {
        MESData.stations.splice(stationIndex, 1);
        saveData();
        navigateToView('stations'); // Refresh the view
        showToast('Station deleted successfully', 'success');
      }
    }

    // Toast notification function
    function showToast(message, type = 'info') {
      // Create toast element
      const toast = document.createElement('div');
      toast.style.cssText = 
        'position: fixed;' +
        'top: 20px;' +
        'right: 20px;' +
        'background: ' + (type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6') + ';' +
        'color: white;' +
        'padding: 12px 20px;' +
        'border-radius: 6px;' +
        'z-index: 9999;' +
        'box-shadow: 0 4px 6px rgba(0,0,0,0.1);' +
        'font-weight: 500;' +
        'opacity: 0;' +
        'transform: translateX(100%);' +
        'transition: all 0.3s ease;';
      
      toast.textContent = message;
      document.body.appendChild(toast);
      
      // Animate in
      setTimeout(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateX(0)';
      }, 10);
      
      // Remove after 3 seconds
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      }, 3000);
    }

    function closeHelp() {
      document.getElementById('help-overlay').classList.remove('active');
      document.getElementById('help-panel').classList.remove('active');
      document.body.style.overflow = 'auto'; // Restore scrolling
    }

    function switchHelpTab(tabName) {
      // Remove active from all tabs and sections
      document.querySelectorAll('.help-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.help-section').forEach(section => section.classList.remove('active'));
      
      // Add active to clicked tab and corresponding section
      event.target.classList.add('active');
      document.getElementById('help-' + tabName).classList.add('active');
    }

    function toggleFAQ(button) {
      const answer = button.nextElementSibling;
      const arrow = button.querySelector('span:last-child');
      
      if (answer.classList.contains('open')) {
        answer.classList.remove('open');
        arrow.textContent = 'â–¼';
      } else {
        // Close all other FAQs
        document.querySelectorAll('.help-faq-answer').forEach(item => {
          item.classList.remove('open');
        });
        document.querySelectorAll('.help-faq-question span:last-child').forEach(arr => {
          arr.textContent = 'â–¼';
        });
        
        // Open this FAQ
        answer.classList.add('open');
        arrow.textContent = 'â–²';
      }
    }

    // Close help panel when pressing Escape
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeHelp();
      }
    });

    // Initialize help system
    document.addEventListener('DOMContentLoaded', function() {
      // Help system is ready
      console.log('ğŸ†˜ Help system initialized');
    });
  </script>
</body>
</html>